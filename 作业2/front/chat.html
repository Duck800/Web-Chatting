<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width-device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
    <title>ChatRoom</title>

    <link href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="dist/css/jquery-ui.min.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="fonts/custom-fonts.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="css/custom-styles.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="css/custom-global.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="css/custom-chat.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="css/animate.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="css/loaders.min.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="js/jquery-confirm/jquery-confirm.min.css" rel="stylesheet" type="text/css" charset="UTF-8" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/emojione/1.5.2/assets/sprites/emojione.sprites.css"
        rel="stylesheet" type="text/css" media="screen">
    <link href="dist/css/emojionearea.css" media="screen" rel="stylesheet" type="text/css">
</head>

<body class="transition-true">

    <!-- 当前用户ID -->
    <input type="hidden" id="UserId" value="1" />

    <!-- 当前用户名 -->
    <input type="hidden" id="UserAccount" value="Earthshaking" />

    <!-- 当前用户密码 -->
    <input type="hidden" id="UserPassword" value="12345" />

    <!-- 当前用户头像 -->
    <input type="hidden" id="UserImg" value="img/user.jpg" />

    <!-- 页面加载效果 -->
    <div id="loading" class="bg-main pb70">
        <i class="icon-spinner3 s32 color-white block loading"></i>
        <span class="loading-title block mt20 color-white">正在加载,请耐心等待...</span>
    </div>

    <!-- 聊天区域 -->
    <div class="chat-content">
        <div class="sideBar" id="Sidebar">
            <div class="logo">
                <img src="img/logo.png" style="width:35px;" />
            </div>
            <div class="currentUser">
                <!--当前用户头像-->
                <a class="currentUserImg" id="sidebarToggleBtn">
                    <img src="img/user.jpg" class="cursor-pointer img-circle" data-toggle="dropdown" >
                </a>
            </div>

        </div>
        <!-- 左侧边栏 -->
        <div class="chat-left" id="chatSidebar">
            <h3 style="position:relative;left:5%;">信息</h3>
            <div class="chat-left-top">
                <form class="form-inline chat-top-form per100">
                    <div class="form-group per100 search-group">
                        <i class="icon-search"></i>
                        <input class="form-control search-input per85 mr5 pull-left" type="text" placeholder="搜索"
                            id="search-friends">
                        <button class="btn addFriendBtn pull-right" title="添加好友" type="button" data-toggle="modal"
                            data-target="#addFriend"><i class="icon-plus"></i></button>
                        <div class="clearfix"></div>
                    </div>
                </form>
            </div>
            <!-- <hr width="90%"
                style="margin:5px auto 0px;border:0.5px solid rgba(0,0,0,0.08);box-shadow: 0 1px 0px rgba(245,245,245,.6)" /> -->
            <!-- 好友列表 -->
            <ul class="friend-list" id="left-friend-list">
                <li>
                    <a class="a-none friend" href="javascript:void(null);">
                        <img src="img/img-1.jpg" class="users-img cursor-pointer img-circle">
                        <span class="friendName s15 strong">登山花椒</span>
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-link a-none dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-dots-horizontal-triple s20"></i>
                        </button>
                        <ol class="dropdown-menu-right dropdown-menu p0 animated fadeInDown" role="menu">
                            <li><a class="p15 pt10 pb10 cursor-pointer deleteFriendBtn" data-toggle="modal"
                                    data-target="#confirmDelete">删除好友</a></li>
                        </ol>
                    </div>
                </li>
                <li>
                    <a class="a-none friend" href="javascript:void(null);">
                        <img src="img/img-2.jpg" class="users-img cursor-pointer img-circle">
                        <span class="friendName s15 strong">南梦之泽</span>
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-link a-none dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-dots-horizontal-triple s20"></i>
                        </button>
                        <ol class="dropdown-menu-right dropdown-menu p0 animated fadeInDown" role="menu">
                            <li><a class="p15 pt10 pb10 cursor-pointer deleteFriendBtn" data-toggle="modal"
                                    data-target="#confirmDelete">删除好友</a></li>
                        </ol>
                    </div>
                </li>
                <li>
                    <a class="a-none friend" href="javascript:void(null);">
                        <img src="img/img-3.jpg" class="users-img cursor-pointer img-circle">
                        <span class="friendName s15 strong">Heelift</span>
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-link a-none dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-dots-horizontal-triple s20"></i>
                        </button>
                        <ol class="dropdown-menu-right dropdown-menu p0 animated fadeInDown" role="menu">
                            <li><a class="p15 pt10 pb10 cursor-pointer deleteFriendBtn" data-toggle="modal"
                                    data-target="#confirmDelete">删除好友</a></li>
                        </ol>
                    </div>
                </li>
                <li>
                    <a class="a-none friend" href="javascript:void(null);">
                        <img src="img/img-4.jpg" class="users-img cursor-pointer img-circle">
                        <span class="friendName s15 strong">AAA彩电维修</span>
                    </a>
                    <div class="dropdown">
                        <button class="btn btn-link a-none dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-dots-horizontal-triple s20"></i>
                        </button>
                        <ol class="dropdown-menu-right dropdown-menu p0 animated fadeInDown" role="menu">
                            <li><a class="p15 pt10 pb10 cursor-pointer deleteFriendBtn" data-toggle="modal"
                                    data-target="#confirmDelete">删除好友</a></li>
                        </ol>
                    </div>
                </li>
            </ul>
        </div>

        <!-- 右侧聊天窗口 -->
        <div class="chat-central">
            <div class="chat-central-top">
                <!-- 聊天icon -->
                <!-- <button class="btn btn-link a-none" id="sidebarBtn">
                    <i class="icon-navicon s20"></i>
                </button> -->
                <a class="a-none friend" href="javascript:void(null);">
                    <img src="img/img-1.jpg" class="users-img cursor-pointer img-circle">
                    <span class="friendName s15 strong">登山花椒</span>
                </a>
                <!-- <button type="button" class="close" id="ifm-close">&times;</button> -->
            </div>

            <!-- 消息显示 -->
            <div class="chat-show my-panel-diy">

                <!-- 自己发的消息 -->
                <div class="my-msg per100 fadeInUp msg">
                    <span class="my-msg-qipao">孙韩雅</span>
                    <img src="img/user.jpg" class="ChatUser-img cursor-pointer ml20 img-circle">
                    <input class="NowTime" value="2018/07/01 07:15:59" type="hidden" />
                </div>

                <div class="my-msg per100 fadeInUp msg">
                    <span class="my-msg-qipao">还在写代码？</span>
                    <img src="img/user.jpg" class="ChatUser-img cursor-pointer ml20 img-circle">
                    <input class="NowTime" value="2018/07/01 07:18:59" type="hidden" />
                </div>

                <!-- 对方发的消息 -->
                <div class="friend-msg per100 fadeInDown msg">
                    <img src="img/img-1.jpg" class="ChatUser-img mr20 cursor-pointer img-circle">
                    <span class="friend-msg-qipao">对啊，我刚写了个聊天页面</span>
                    <input class="NowTime" value="2018/07/01 08:21:59" type="hidden" />
                </div>

                <!-- 自己发的消息 -->
                <div class="my-msg per100 fadeInUp msg">
                    <span class="my-msg-qipao">啥样的</span>
                    <img src="img/user.jpg" class="ChatUser-img cursor-pointer ml20 img-circle">
                    <input class="NowTime" value="2018/07/05 06:12:59" type="hidden" />
                </div>
                <!-- 对方发的消息 -->
                <div class="friend-msg per100 fadeInDown msg">
                    <img src="img/img-1.jpg" class="ChatUser-img mr20 cursor-pointer img-circle">
                    <img src="img/UIDesign.png" style="width:400px;border-radius:5px;" />
                    <input class="NowTime" value="2018/07/08 08:18:59" type="hidden" />
                </div>

                <!-- 对方发的消息 -->
                <div class="friend-msg per100 fadeInDown msg">
                    <img src="img/img-1.jpg" class="ChatUser-img mr20 cursor-pointer img-circle">
                    <span class="friend-msg-qipao">这是设计图</span>
                    <input class="NowTime" value="2018/07/08 08:18:59" type="hidden" />
                </div>

            </div>
            <!-- 输入消息区域 -->
            <div class="chat-input">
                <form class="chat-form" role="form" action="#" method="post">
                    <div class="form-group m0">
                        <!-- 输入消息的文本域 -->
                        <textarea id="chat-textarea" class="form-control" maxlength="300"></textarea>
                    </div>
                    <div class="form-group m0 pr15 pb15 pt5 white-bg relative">
                        <!-- 发送消息的按钮 -->
                        <span class="alertTips">不能发送空的消息</span>
                        <button class="sendMsgBtn" id="sendMsgBtn">发送(s)</button>
                        <div class="clearfix"></div>
                    </div>
                </form>
            </div>
        </div>
        <!-- 右侧边栏 -->
        <div class="chat-right" id="infoSidebar">
            <div class="chat-right-top">
                <h4 class="chat-title">
                    <span id="PersonInfo">用户信息</span>
                </h4>
                <button type="button" class="close" id="ifm-close">&times;</button>
            </div>
            <div class="currentUser">
                <!--当前用户头像-->
                <div class="changeAvatar">
                    <img src="img/user.jpg" class="cursor-pointer img-circle" width="80">
                </div>
                <span class="currentUserAccount">八百斤鸭</span>
            </div>
            <div class="userInfo">
                <row style="width:100%; display: flex; margin: 0px 0px 20px 0px;">
                    <column style="flex-basis: 50%">
                        <strong>ID</strong>
                    </column>
                    <column>
                        <span>Duck_800</span>
                    </column>
                </row>
                <row style="width:100%; display: flex;">
                    <column style="flex-basis: 50%">
                        <strong>性别</strong>
                    </column>
                    <column>
                        <strong>地区</strong>
                    </column>
                </row>
                <row style="width:100%; display: flex;">
                    <column style="flex-basis: 50%">
                        <span>女</span>
                    </column>
                    <column>
                        <span>江苏 南通</span>
                    </column>
                </row>
                <row style="width:100%; display: flex;margin: 5px 0px 0px 0px;">
                    <column style="flex-basis: 50%">
                        <strong>生日</strong>
                    </column>
                    <column>
                        <strong>星座</strong>
                    </column>
                </row>
                <row style="width:100%; display: flex;">
                    <column style="flex-basis: 50%">
                        <span>2003-09-29</span>
                    </column>
                    <column>
                        <span>天秤座</span>
                    </column>
                </row>
                <row style="width:100%; display: flex; margin: 20px 0px 0px 0px;">
                    <column style="flex-basis: 50%">
                        <strong>个性签名</strong>
                    </column>
                </row>
                <row style="width:100%; display: flex;">
                    <column style="flex-basis: 100%">
                        <span>一枚脆弱而精致的软工大三学生。</span>
                    </column>
                </row>
            </div>
            <div>
                <!-- 修改信息的按钮 -->
                <button class="InfoBtn">修改信息</button>
            </div>
        </div>

    </div>
    </div>

    <!-- 添加好友模态框 -->
    <div class="modal fade" id="addFriend" tabindex="-1" aria-hidden="false" role="dialog"
        aria-labelledby="myModalLabel">
        <div class="modal-dialog" style="width: 450px;margin-top: 100px;">
            <div class="modal-content " style="overflow: hidden">
                <div class="modal-header gray-bg pl10 pb10 pt10">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title s14"><i class="icon-uniF071 mr5 s15"></i>添加好友</h4>
                </div>
                <div class="modal-body text-center pt25">
                    <form class="search-friend">
                        <div class="form-group relative">
                            <i class="icon-search mySearch"></i>
                            <input class="form-control" type="text" placeholder="搜索朋友" id="search-users">
                        </div>
                        <p class="pt10 pb10 s13 gray-bg m0 btlr btrr search-result-title">搜索结果</p>
                        <div class="form-group search-result-wrap bbrr bblr my-panel-diy" style="height: 380px">

                            <ul class="friend-list" style="height: auto;" id="searchUsersResult">

                                <li id="nullSearchResult">
                                    <span class="text-center block pt25 pb25 s15"
                                        style="color: rgba(0,0,0,0.63);">请输入您要搜索的用户</span>
                                </li>
                                <!--<li><a class="a-none" href="javascript:void(null);">-->
                                <!--<img src="img/img-1.jpg" class="users-img cursor-pointer img-circle">-->
                                <!--<span class="friendName s15 strong">Friend 01</span>-->
                                <!--<button class="btn white-bg btn-sm addBtns" type="button">添加</button>-->
                                <!--</a></li>-->
                            </ul>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 确认是否删除好友模态框 -->
    <div class="modal fade" id="confirmDelete" tabindex="-1" aria-hidden="false" role="dialog"
        aria-labelledby="myModalLabel">
        <div class="modal-dialog" style="width: 350px;margin-top: 200px;">
            <div class="modal-content " style="overflow: hidden">
                <div class="modal-header alert-danger pl10 pb10 pt10">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title s14"><i class="icon-warning mr5 s15"></i>警告</h4>
                </div>
                <div class="modal-body text-center pt25">
                    <form id="deleteFriend-form">
                        <p class="pt15 pb15 s16 flex-center">
                            <!-- 将要删除的好友用户名 -->
                            <input type="hidden" id="DeleteFriendAccount" value="">
                            <input type="hidden" id="myAccount" value="">
                            <strong class="modal-alert text-left">
                                确定要删除这个好友吗?
                            </strong>
                        </p>
                        <div class="form-group mb5 mt15">
                            <button class="btn btn-default per25" data-dismiss="modal" type="button">取消</button>
                            <button class="btn btn-danger per25" type="button" id="yesDelete">确认</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改头像模态框 -->
    <div class="modal fade" id="updateImg" tabindex="-1" aria-hidden="false" role="dialog"
        aria-labelledby="myModalLabel">
        <div class="modal-dialog" style="width: 650px;margin-top: 100px;">
            <div class="modal-content " style="overflow: hidden">
                <div class="modal-header gray-bg pl10 pb10 pt10">
                    <button class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title s14"><i class="icon-image mr5 s15"></i>修改头像</h4>
                </div>
                
            </div>
        </div>
    </div>


    <script src="js/jquery-2.1.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="bootstrap-3.3.7-dist/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="dist/js/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/custom-scripts.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/mustache.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/jquery-confirm/jquery-confirm.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/emojione/1.5.2/lib/js/emojione.min.js"></script>
    <script type="text/javascript" src="dist/js/emojionearea.min.js"></script>
    <script>
        // 页面全部加载完成后 loading动画消失
        window.onload = function () {
            setTimeout(function () {
                $("#loading").fadeOut();
            }, 300);
        };

        $(function () {
            $(document).tooltip();

            // 当前登录的用户 构造函数
            var currentUser = function (id, account, password, img) {
                var person = {
                    id: id,
                    name: account,
                    password: password,
                    img: img
                };
                return person;
            };

            var uid = $("#UserId").val(); // 当前用户id
            var uaccount = $("#UserAccount").val(); // 当前用户名
            var uimg = $("#UserImg").val(); // 当前用户头像
            var upassword = $("#UserPassword").val(); // 当前用户头像

            // 封装当前登录的用户
            var thisUser = currentUser(uid, uaccount, upassword, uimg);
            $("#userInfoImg").attr('src', thisUser.img);
            $("#userInfoAccount").text(thisUser.name);
            $("#userInfoPassword").val(thisUser.password);

            var chatShow = $(".chat-show");

            // 表情插件初始化
            $("#chat-textarea").emojioneArea({
                template: "<filters/><tabs/><editor/>",
                autoHideFilters: false
            });

            // 按回车键发送信息
            $(".emojionearea-editor").keydown(function (e) {
                if (event.keyCode == "13") {//keyCode=13是回车键
                    e.preventDefault();
                    $("#sendMsgBtn").click();
                }
            });

            // 当前的日期与时间
            var nowTime = function (date) {
                var Y = date.getFullYear();  // 年
                var M = date.getMonth() + 1; // 月
                var D = date.getDate();      // 日
                var h = date.getHours();     // 时
                var m = date.getMinutes();   // 分
                var s = date.getSeconds();   // 秒

                var nowDate = Y + "-" + M + "-" + D + " " + h + ":" + m + ":" + s;
                return nowDate;
            };

            // 点击发送信息
            $("#sendMsgBtn").click(function () {
                var mydate = new Date();// 时间
                var nowtimes = nowTime(mydate);
                // var msgVal = $("#chat-textarea").val();

                var msgVal = $(".emojionearea-editor").html();
                var msgNode = "";

                if (msgVal != "") {

                    // 生成发送的消息
                    msgNode += "<span class='my-msg-qipao'>" + msgVal + "</span>" +
                        "       <img src='" + thisUser.img + "' class='users-img cursor-pointer ml20 img-circle'>" +
                        "       <input class='NowTime' value='" + nowtimes + "' type='hidden'/>";

                    // 生成发送的消息的div
                    var msgNodeDiv = "<div class='my-msg per100 animated fadeInUp msg'>" + msgNode + "</div>";

                    chatShow.append(msgNodeDiv);// 添加到会话窗口
                    var scrollTopPx = $(".chat-show")[0].scrollHeight;
                    chatShow.animate({ scrollTop: scrollTopPx }, 500); // 会话窗口滚动到最底部
                    $(".emojionearea-editor").html("");// 清空会话窗口

                } else {

                    // 显示不可发送空消息的提示
                    $(".alertTips").fadeIn();
                    setTimeout(function () {
                        $(".alertTips").fadeOut();
                    }, 2000);

                }
            });

            // 获取按钮和侧边栏元素
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
            const infoSidebar = document.getElementById('infoSidebar');

            // 点击事件处理函数
            function toggleSidebar() {
                infoSidebar.classList.toggle('show');
            }

            // 绑定点击事件监听器
            sidebarToggleBtn.addEventListener('click', toggleSidebar);

            // 好友列表
            var friends = [
                { id: 1, img: "img/img-1.jpg", name: "张三" },
                { id: 2, img: "img/img-2.jpg", name: "李四" },
                { id: 3, img: "img/img-3.jpg", name: "王五" },
                { id: 4, img: "img/img-4.jpg", name: "赵孙" },
                { id: 5, img: "img/img-5.jpg", name: "小强" },
                { id: 6, img: "img/img-3.jpg", name: "武松" }
            ];

            // 初始化所有好友
            var initFriends = function () {
                var friendNode = "";
                for (var i = 0; i < friends.length; i++) {
                    friendNode += "<li><a class=\"a-none\" href=\"javascript:void(null);\">\n" +
                        "                    <input class=\"friendId\" type=\"hidden\" value=\"" + friends[i].id + "\"/>\n" +
                        "                    <img src=\"" + friends[i].img + "\" class=\"users-img cursor-pointer img-circle\">\n" +
                        "                    <span class=\"friendName s15 strong\">" + friends[i].name + "</span>\n" +
                        "                </a></li>";
                }
                $("#left-friend-list").append(friendNode);
            };

            // initFriends();

            // 搜索用户框
            var searchUsers = $("#search-users");
            // 搜索好友框
            var searchFriends = $("#search-friends");

            // 搜索好友
            searchFriends.keyup(function () {
                var queryStr = $(this).val(); // 搜索框内输入的值

                // 获取搜索结果的长度
                var resultSize = $("#left-friend-list li").hide().find(".friendName").filter(":contains('" + queryStr + "')").size();

                if (resultSize > 0) {
                    // 搜索结果的长度 > 0  搜索结果不为空
                    $("#left-friend-list li").hide().find(".friendName").filter(":contains('" + queryStr + "')").parent('a').parent('li').show();
                } else {
                    // 搜索结果的长度 <= 0  搜索结果为空
                    $("#left-friend-list li:not(#notResult)").hide();
                    $("#left-friend-list li#notResult").show();
                }

            });

            // 搜索用户
            searchUsers.keyup(function () {
                // 搜索不到内容时显示的元素
                var noSearchResult = "<li id='notSearchResult'>" +
                    "                      <span class='text-center block pt25 pb25 s15' style='border-bottom:1px solid rgba(102,102,102,0.08);color: rgba(0,0,0,0.63);'>用户不存在...</span>" +
                    "                 </li>";
                // 搜索的值为空时显示的元素
                var nullSearchResult = "<li id='nullSearchResult'>" +
                    "                      <span class='text-center block pt25 pb25 s15' style='color: rgba(0,0,0,0.63);'>请输入您要搜索的用户</span>" +
                    "                 </li>";

                var searchUsersResult = $("#searchUsersResult");
                searchUsersResult.empty();
                var node = "";
                var userName = $(this).val();
                var data = "username=" + userName;

                if (userName != "") {
                    searchUsersResult.append(noSearchResult);

                    $("#left-friend-list li:not(#notResult)").each(function () {

                        if ($(this).find(".friendName").text() == userName) {

                            searchUsersResult.empty();

                            var fimg = $(this).find('img').attr('src');

                            node += "<a class=\"a-none\" href=\"javascript:void(null);\">\n" +
                                "                                <img src=\"" + fimg + "\" class=\"users-img cursor-pointer img-circle\">\n" +
                                "                                <span class=\"friendName s15 strong\">" + userName + "</span>\n" +
                                "                                <button class=\"btn white-bg btn-sm addBtns clearClass\" type=\"button\" data-toggle=\"modal\" data-target=\"#addFriendOk\">已添加</button>\n" +
                                "                            </a>";
                            var mynode = "<li>" + node + "</li>";

                            searchUsersResult.append(mynode);

                        } else {

                            $.ajax({
                                url: 'searchUsermsg',
                                type: 'post',
                                data: data,
                                success: function (userList) {
                                    console.log(userList);
                                    if (userList != "空") {
                                        // 如果返回值不为空
                                        var x = eval('(' + userList + ')');// 解析后台返回的json数据

                                        // 生成元素
                                        node += "<a class=\"a-none\" href=\"javascript:void(null);\">\n" +
                                            "                                <img src=\"" + x.userimg + "\" class=\"users-img cursor-pointer img-circle\">\n" +
                                            "                                <span class=\"friendName s15 strong\">" + x.useraccount + "</span>\n" +
                                            "                                <button class=\"btn white-bg btn-sm addBtns\" type=\"button\" data-toggle=\"modal\" data-target=\"#addFriendOk\">添加</button>\n" +
                                            "                            </a>";

                                        var mynode = "<li>" + node + "</li>";
                                        // 添加节点 显示在页面上
                                        searchUsersResult.append(mynode);
                                    } else {
                                        $("#searchUsersModal").empty(); // 如果返回值为空就清空搜索结果
                                        searchUsersResult.append(noSearchResult);
                                    }
                                }
                            });
                        }

                    });
                } else {
                    searchUsersResult.empty();
                    searchUsersResult.append(nullSearchResult);
                }
            });

            // 点击左侧好友列表
            $(".chat-left").find("#left-friend-list li").click(function () {
                $(this).find('a.friend').addClass('active');// 添加点击效果

                var currentFriend = $(this).find('.friendName').text(); // 获取点击的好友用户名

                $('#current-friend').text(currentFriend); // 添加到聊天窗口顶部标题处

                chatShow.html(""); // 刷新/清空聊天窗口

                $(this).siblings().children('a.friend').removeClass('active');
            });

            // 点击删除好友
            $(".deleteFriendBtn").on("click", function () {
                var friendNames = $(this).parents('li').find('.friendName').text();
                $("#DeleteFriendAccount").val(friendNames);
                $("#myAccount").val(thisUser.name);
            });

            // 修改头像 选择头像
            $(".img-list li").find('a').on("click", function () {
                $(this).find("input[name='checkImg']").prop('checked', 'true');
                $(this).addClass('active');
                $(this).parent().siblings().find('a').removeClass('active');
            });

            // 获取消息
            var getMsg = function () {
                console.log("获取消息...");
            };

            // 消息根据时间排序
            var msgSort = function () {
                var lis = [];
                lis = $(".msg");

                var ux = [];

                // 循环提取时间，调用排序方法进行排序
                for (var i = 0; i < lis.length; i++) {
                    var tmp = {};
                    tmp.dom = lis.eq(i);
                    tmp.date = new Date(lis.eq(i).find(".NowTime").val().replace(/-/g, '/'));
                    ux.push(tmp);
                }

                // 数组排序，支持年的比较
                ux.sort(function (a, b) {
                    var myDate = new Date();
                    var year = myDate.getYear();

                    if (a.date.getYear < year && b.date.getYear == year) {
                        return true;
                    }
                    return a.date - b.date;
                });

                // 移除原先顺序错乱的内容
                chatShow.empty();

                // 重新添加排序好的内容
                for (var q = 0; q < ux.length; q++) {
                    chatShow.append(ux[q].dom);
                }


            };

            msgSort();

            $("#sidebarBtn").on("click", function (e) {
                $("#chatSidebar").removeClass('bounceOutLeft').addClass('bounceInLeft').show();

                $(document).on("click", function () {
                    if ($("#chatSidebar").hasClass('bounceInLeft')) {
                        $("#chatSidebar").removeClass('bounceInLeft').addClass('bounceOutLeft').hide();
                    }
                });

            });
        });
    </script>
</body>

</html>